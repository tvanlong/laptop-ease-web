name: Keep Render Service Alive

on:
  schedule:
    # Cháº¡y má»—i 14 phÃºt
    - cron: '*/14 * * * *'
  
  # Cho phÃ©p cháº¡y manual
  workflow_dispatch:
    inputs:
      reason:
        description: 'LÃ½ do cháº¡y manual'
        required: false
        default: 'Manual health check'

env:
  # THAY Äá»”I URL NÃ€Y Báº°NG URL RENDER SERVICE Cá»¦A Báº N
  SERVICE_URL: https://laptop-ease-web.onrender.com

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“‹ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸ¥ Health Check
      run: |
        echo "ğŸš€ Báº¯t Ä‘áº§u health check táº¡i $(date)"
        echo "ğŸŒ URL target: $SERVICE_URL/health"
        
        # Retry vá»›i 3 láº§n thá»­
        for attempt in 1 2 3; do
          echo "ğŸ“ Láº§n thá»­ $attempt/3"
          
          if curl -f --max-time 30 \
               -H "User-Agent: GitHub-Actions-KeepAlive/1.0" \
               -w "Status: %{http_code}, Time: %{time_total}s\n" \
               "$SERVICE_URL/health"; then
            echo "âœ… Health check thÃ nh cÃ´ng á»Ÿ láº§n thá»­ $attempt"
            exit 0
          else
            echo "âŒ Health check tháº¥t báº¡i á»Ÿ láº§n thá»­ $attempt"
            if [ $attempt -lt 3 ]; then
              echo "â³ Chá» 10s trÆ°á»›c khi thá»­ láº¡i..."
              sleep 10
            fi
          fi
        done
        
        echo "ğŸš¨ Táº¥t cáº£ cÃ¡c láº§n thá»­ Ä‘á»u tháº¥t báº¡i"
        exit 1

    - name: ğŸ“Š BÃ¡o cÃ¡o káº¿t quáº£
      if: always()
      run: |
        echo "ğŸ“ˆ TÃ³m táº¯t:"
        echo "- Thá»i gian: $(date)"
        echo "- Service URL: $SERVICE_URL"
        
        if [ $? -eq 0 ]; then
          echo "- Tráº¡ng thÃ¡i: âœ… Healthy"
        else
          echo "- Tráº¡ng thÃ¡i: âŒ CÃ³ váº¥n Ä‘á»"
        fi